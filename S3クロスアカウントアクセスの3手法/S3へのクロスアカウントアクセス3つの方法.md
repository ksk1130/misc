# S3のクロスアカウントアクセス3つの方法

1. IAMユーザの作成

   ##### 特徴

   アクセス先アカウントのIAMユーザを発行してもらう

   ##### メリット

   シンプルな方式

   ##### デメリット

   アクセス先アカウント側でアカウントを管理する必要あり

   

2. バケットポリシーで許可

   ##### 特徴

   アクセス先アカウントのバケットポリシーにアクセス元アカウントのARNを記述

   ##### メリット

   クレデンシャル管理が不要

   ##### デメリット

   アップロードしたオブジェクトにバケットポリシーが適用されない。

   気を付ける点2点：

   ①アカウントBからオブジェクトをアップロードした場合、オブジェクトの所有者はアカウントB（バケット所有者のアカウントAとは別のアカウント）になるためバケットポリシーがオブジェクトに適用されません。
   例えば、静的ウェブホスティングを有効にしているバケットに、アカウントBからオブジェクトをアップロードしても、バケットポリシーが適用されないため、アップロードしただけではそのコンテンツは公開できません

   ②アカウントBにVPCエンドポイントがある場合には注意が必要。VPCエンドポイントは指定のリージョンのすべてのS3に対するエンドポイントとなります。すなわち、アカウントAのS3バケットにアクセスする際にもVPCエンドポイント経由になります。そのため、アカウントBのインスタンスはVPCエンドポイント経由でアクセスしてくるので、バケットポリシーで接続先を制限する場合は、VPCエンドポイントのIDで制限する必要があります。

   

3. 一時認証情報の発行

   ##### 特徴

   STS(一時認証情報を発行するサービス)を用いて、アクセス先アカウントへの一時認証情報を取得してアクセスする

   ##### メリット

   クレデンシャル管理が不要。また「バケットポリシー」方式のデメリットも回避可能

   ##### デメリット

   一時クレデンシャルを扱う処理が必要(アクセス先アカウントのS3にアクセスする際に一時認証情報の取得処理を行う必要あり)